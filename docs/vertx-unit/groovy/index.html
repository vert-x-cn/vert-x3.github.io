<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vertx unit - Vert.x</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="Eclipse Vert.x is a tool-kit for building reactive applications on the JVM." name="description">
  <link href="https://vertx.tk/stylesheets/docs.css" media="screen" rel="stylesheet">
  <link href="https://vertx.tk/stylesheets/font-awesome.min.css" media="screen" rel="stylesheet">
  <link href="https://vertx.tk/javascripts/styles/rainbow.min.css" media="screen" rel="stylesheet">
  <!-- IE 6-8 support of HTML 5 elements -->
  <!--[if lt IE 9]>
  <script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script>
  <![endif]-->

  <link rel="apple-touch-icon" sizes="57x57" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://vertx.tk/assets/favicons/vertx-favicon-7/manifest.json">
  <link rel="mask-icon" href="https://vertx.tk/assets/favicons/vertx-favicon-7/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#7d3194">
  <meta name="msapplication-TileImage" content="https://vertx.tk/assets/favicons/vertx-favicon-7/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link href="https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel="stylesheet" type="text/css">
  <link rel="alternate" type="application/rss+xml" title="RSS"
     href="https://vertx.tk/feed.xml">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('create', 'UA-71153120-1', 'auto', 'tracker');
    ga('send', 'pageview');
    ga('tracker.send', 'pageview');
  </script>
  <style>
    .page-link-to-github {
      position: relative;
      z-index: 1;
      display: inline-block;
      border: 1px solid #782B90;
      border-radius: 5px;
      color: #782B90;
      font-size: 12px;
      padding: 4px 10px;
      text-decoration: none;
      background-color: #ffffff;
    }
    .page-link-to-github:hover {
      color: #ffffff;
      border-color: #ffffff;
      background-color: #782B90;
    }

    .page-link-to-github .github-icon {
      position: absolute;
      display: inline-block;
      width: 20px;
      height: 20px;
      /*background-position: -50px 0*/
      background: url('https://vertx.tk/assets/github.png') no-repeat 0 0;
    }

    @media (-webkit-min-device-pixel-ratio: 2),(min-resolution:192dpi) {
      .page-link-to-github .github-icon {
        background-image:url('https://vertx.tk/assets/github@2x.png');
        background-size: 150px auto
      }
    }

    .page-link-to-github:hover .github-icon {
      /*background-position: 0 0*/
      background-position: -100px 0
    }
    .text {
      text-decoration: underline
    }
    .page-link-to-github .text {
      padding-left: 27px
    }
    .text {
      padding-right: 8px
    }
    .page-link-to-github {
      float: right;
      top: 4px
    }

  </style>
</head>
<body>

<a href="http://www.reactivemanifesto.org/" id="reactive-manifesto-banner">
  <img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000"
    src="https://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png">
</a>

<a id="skippy" class="sr-only sr-only-focusable" href="#content"><div class="container"><span class="skiplink-text">Skip to main content</span></div></a>

<header class="navbar navbar-default navbar-static-top" id="top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#vertx-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="https://vertx.tk/" class="navbar-brand"><img alt="Brand" src="https://vertx.tk/assets/logo-sm.png"></a>
    </div>
    <nav class="collapse navbar-collapse" id="vertx-navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="http://start.vertx.io">Starter</a></li>
        <li><a href="https://vertx.tk/download/">下载</a></li>
        <li><a href="https://vertx.tk/docs/">文档</a></li>
        <li><a href="https://github.com/vert-x3/wiki/wiki">维基</a></li>
        <li><a href="https://vertx.tk/community/">社区</a></li>
        <li><a href="https://vertx.tk/materials/">资料</a></li>
        <li><a href="https://vertx.tk/blog/">博客</a></li>
      </ul>
    </nav>
  </div>
</header>



  <div class="page-header" id="content">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1>Vertx unit</h1>
          
        </div>
      </div>
    </div>
  </div>



<div id="content">
  <div class="container docs-content">
    <div class="row">
      <div class="col-sm-12 col-md-push-9 col-md-3 hidden-xs hidden-sm">
        <div id="sidebar" data-spy="affix">
          <ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_writing_a_test_suite">Writing a test suite</a></li>
<li><a href="#_asserting">Asserting</a>
<ul class="sectlevel2">
<li><a href="#_assertequals">assertEquals</a></li>
<li><a href="#_assertnotequals">assertNotEquals</a></li>
<li><a href="#_assertnull">assertNull</a></li>
<li><a href="#_assertnotnull">assertNotNull</a></li>
<li><a href="#_assertinrange">assertInRange</a></li>
<li><a href="#_asserttrue_and_assertfalse">assertTrue and assertFalse</a></li>
<li><a href="#_failing">Failing</a></li>
<li><a href="#_using_third_party_assertion_framework">Using third-party assertion framework</a></li>
</ul>
</li>
<li><a href="#_asynchronous_testing">Asynchronous testing</a></li>
<li><a href="#_asynchronous_assertions">Asynchronous assertions</a></li>
<li><a href="#_repeating_test">Repeating test</a></li>
<li><a href="#_sharing_objects">Sharing objects</a></li>
<li><a href="#_running">Running</a>
<ul class="sectlevel2">
<li><a href="#_test_suite_completion">Test suite completion</a></li>
<li><a href="#_time_out">Time out</a></li>
<li><a href="#event_loop">Event loop</a></li>
</ul>
</li>
<li><a href="#reporting">Reporting</a>
<ul class="sectlevel2">
<li><a href="#_console_reporting">Console reporting</a></li>
<li><a href="#_file_reporting">File reporting</a></li>
<li><a href="#_log_reporting">Log reporting</a></li>
<li><a href="#_event_bus_reporting">Event bus reporting</a></li>
</ul>
</li>
<li><a href="#vertx_integration">Vertx integration</a></li>
<li><a href="#_junit_integration">Junit integration</a>
<ul class="sectlevel2">
<li><a href="#_running_a_test_on_a_vert_x_context">Running a test on a Vert.x context</a></li>
<li><a href="#_timeout">Timeout</a></li>
<li><a href="#_parameterized_tests">Parameterized tests</a></li>
<li><a href="#_repeating_a_test">Repeating a test</a></li>
<li><a href="#_using_with_other_assertion_libraries">Using with other assertion libraries</a></li>
</ul>
</li>
<li><a href="#_java_language_integration">Java language integration</a>
<ul class="sectlevel2">
<li><a href="#_test_suite_integration">Test suite integration</a></li>
</ul>
</li>
</ul>
        </div>
      </div>
      <div class="col-sm-12 col-md-pull-3 col-md-9">
        <div class="toc hidden-md hidden-lg">
          <h2>Table of Contents</h2>
          <ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_writing_a_test_suite">Writing a test suite</a></li>
<li><a href="#_asserting">Asserting</a>
<ul class="sectlevel2">
<li><a href="#_assertequals">assertEquals</a></li>
<li><a href="#_assertnotequals">assertNotEquals</a></li>
<li><a href="#_assertnull">assertNull</a></li>
<li><a href="#_assertnotnull">assertNotNull</a></li>
<li><a href="#_assertinrange">assertInRange</a></li>
<li><a href="#_asserttrue_and_assertfalse">assertTrue and assertFalse</a></li>
<li><a href="#_failing">Failing</a></li>
<li><a href="#_using_third_party_assertion_framework">Using third-party assertion framework</a></li>
</ul>
</li>
<li><a href="#_asynchronous_testing">Asynchronous testing</a></li>
<li><a href="#_asynchronous_assertions">Asynchronous assertions</a></li>
<li><a href="#_repeating_test">Repeating test</a></li>
<li><a href="#_sharing_objects">Sharing objects</a></li>
<li><a href="#_running">Running</a>
<ul class="sectlevel2">
<li><a href="#_test_suite_completion">Test suite completion</a></li>
<li><a href="#_time_out">Time out</a></li>
<li><a href="#event_loop">Event loop</a></li>
</ul>
</li>
<li><a href="#reporting">Reporting</a>
<ul class="sectlevel2">
<li><a href="#_console_reporting">Console reporting</a></li>
<li><a href="#_file_reporting">File reporting</a></li>
<li><a href="#_log_reporting">Log reporting</a></li>
<li><a href="#_event_bus_reporting">Event bus reporting</a></li>
</ul>
</li>
<li><a href="#vertx_integration">Vertx integration</a></li>
<li><a href="#_junit_integration">Junit integration</a>
<ul class="sectlevel2">
<li><a href="#_running_a_test_on_a_vert_x_context">Running a test on a Vert.x context</a></li>
<li><a href="#_timeout">Timeout</a></li>
<li><a href="#_parameterized_tests">Parameterized tests</a></li>
<li><a href="#_repeating_a_test">Repeating a test</a></li>
<li><a href="#_using_with_other_assertion_libraries">Using with other assertion libraries</a></li>
</ul>
</li>
<li><a href="#_java_language_integration">Java language integration</a>
<ul class="sectlevel2">
<li><a href="#_test_suite_integration">Test suite integration</a></li>
</ul>
</li>
</ul>
        </div>

  <a href="https://github.com/okou19900722/vertx-web-site-translation-chinese/tree/master/vertx-translation-stack/vertx-unit-translation"
     class="page-link-to-github"
     target="_blank"
     title="Edit this page on GitHub">
    <i class="github-icon"></i>
    <span class="text">编辑本页</span>
  </a>

        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Asynchronous polyglot unit testing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vertx Unit is designed for writing asynchronous unit tests with a polyglot API and running these tests
in the JVM. Vertx Unit Api borrows from existing test frameworks like <a href="http://junit.org">JUnit</a> or <a href="http://qunitjs.com">QUnit</a>
and follows the Vert.x practices.</p>
</div>
<div class="paragraph">
<p>As a consequence Vertx Unit is the natural choice for testing Vert.x applications.</p>
</div>
<div class="paragraph">
<p>To use vert.x unit, add the following dependency to the <em>dependencies</em> section of your build descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven (in your <code>pom.xml</code>):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
 &lt;groupId&gt;io.vertx&lt;/groupId&gt;
 &lt;artifactId&gt;vertx-unit&lt;/artifactId&gt;
 &lt;version&gt;3.6.0-SNAPSHOT&lt;/version&gt;
 &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle (in your <code>build.gradle</code> file):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">testCompile ${io.vertx}:${vertx-unit}:3.6.0-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vert.x unit can be used in different ways and run anywhere your code runs, it is just a matter of reporting
the results the right way, this example shows the bare minimum test suite:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def suite = TestSuite.create("the_test_suite")
suite.test("my_test_case", { context -&gt;
  def s = "value"
  context.assertEquals("value", s)
})
suite.run()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The {@code run} method will execute the suite and go through all the
tests of the suite. The suite can fail or pass, this does not matter if the outer world is not aware
of the test result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def suite = TestSuite.create("the_test_suite")
suite.test("my_test_case", { context -&gt;
  def s = "value"
  context.assertEquals("value", s)
})
suite.run([
  reporters:[
    [
      to:"console"
    ]
  ]
])</code></pre>
</div>
</div>
<div class="paragraph">
<p>When executed, the test suite now reports to the console the steps of the test suite:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Begin test suite the_test_suite
Begin test my_test
Passed my_test
End test suite the_test_suite , run: 1, Failures: 0, Errors: 0</pre>
</div>
</div>
<div class="paragraph">
<p>The {@code reporters} option configures the reporters used by the suite runner for reporting the execution
of the tests, see the <a href="#reporting">Reporting</a> section for more info.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_a_test_suite">Writing a test suite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A test suite is a named collection of test case, a test case is a straight callback to execute. The suite can
have lifecycle callbacks to execute <em>before</em> and/or <em>after</em> the test cases or the test suite that are used for
initializing or disposing services used by the test suite.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def suite = TestSuite.create("the_test_suite")
suite.test("my_test_case_1", { context -&gt;
  // Test 1
})
suite.test("my_test_case_2", { context -&gt;
  // Test 2
})
suite.test("my_test_case_3", { context -&gt;
  // Test 3
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The API is fluent and therefore the test cases can be chained:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def suite = TestSuite.create("the_test_suite")
suite.test("my_test_case_1", { context -&gt;
  // Test 1
}).test("my_test_case_2", { context -&gt;
  // Test 2
}).test("my_test_case_3", { context -&gt;
  // Test 3
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test cases declaration order is not guaranteed, so test cases should not rely on the execution of
another test case to run. Such practice is considered as a bad one.</p>
</div>
<div class="paragraph">
<p>Vertx Unit provides <em>before</em> and <em>after</em> callbacks for doing global setup or cleanup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def suite = TestSuite.create("the_test_suite")
suite.before({ context -&gt;
  // Test suite setup
}).test("my_test_case_1", { context -&gt;
  // Test 1
}).test("my_test_case_2", { context -&gt;
  // Test 2
}).test("my_test_case_3", { context -&gt;
  // Test 3
}).after({ context -&gt;
  // Test suite cleanup
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The declaration order of the method does not matter, the example declares the <em>before</em> callback before
the test cases and <em>after</em> callback after the test cases but it could be anywhere, as long as it is done before
running the test suite.</p>
</div>
<div class="paragraph">
<p>The <em>before</em> callback is executed before any tests, when it fails, the test suite execution will stop and the
failure is reported. The <em>after</em> callback is the last callback executed by the testsuite, unless
the <em>before</em> callback reporter a failure.</p>
</div>
<div class="paragraph">
<p>Likewise, Vertx Unit provides the <em>beforeEach</em> and <em>afterEach</em> callback that do the same but are executed
for each test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def suite = TestSuite.create("the_test_suite")
suite.beforeEach({ context -&gt;
  // Test case setup
}).test("my_test_case_1", { context -&gt;
  // Test 1
}).test("my_test_case_2", { context -&gt;
  // Test 2
}).test("my_test_case_3", { context -&gt;
  // Test 3
}).afterEach({ context -&gt;
  // Test case cleanup
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>beforeEach</em> callback is executed before each test case, when it fails, the test case is not executed and the
failure is reported. The <em>afterEach</em> callback is the executed just after the test case callback, unless
the <em>beforeEach</em> callback reported a failure.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asserting">Asserting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vertx Unit provides the <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html">TestContext</a></code> object for doing assertions in test cases. The <em>context</em>
object provides the usual methods when dealing with assertions.</p>
</div>
<div class="sect2">
<h3 id="_assertequals">assertEquals</h3>
<div class="paragraph">
<p>Assert two objects are equals, works for <em>basic</em> types or <em>json</em> types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;
  context.assertEquals(10, callbackCount)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also an overloaded version for providing a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;
  context.assertEquals(10, callbackCount, "Should have been 10 instead of ${callbackCount}")
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually each assertion provides an overloaded version.</p>
</div>
</div>
<div class="sect2">
<h3 id="_assertnotequals">assertNotEquals</h3>
<div class="paragraph">
<p>The counter part of <em>assertEquals</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;
  context.assertNotEquals(10, callbackCount)
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_assertnull">assertNull</h3>
<div class="paragraph">
<p>Assert an object is null, works for <em>basic</em> types or <em>json</em> types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;
  context.assertNull(null)
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_assertnotnull">assertNotNull</h3>
<div class="paragraph">
<p>The counter part of <em>assertNull</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;
  context.assertNotNull("not null!")
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_assertinrange">assertInRange</h3>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html#assertInRange-double-double-double-">assertInRange</a></code> targets real numbers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>suite.test("my_test_case", { context -&gt;

  // Assert that 0.1 is equals to 0.2 +/- 0.5

  context.assertInRange(0.1d, 0.2d, 0.5d)
})</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_asserttrue_and_assertfalse">assertTrue and assertFalse</h3>
<div class="paragraph">
<p>Asserts the value of a boolean expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;
  context.assertTrue(var)
  context.assertFalse(value &gt; 10)
})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_failing">Failing</h3>
<div class="paragraph">
<p>Last but not least, <em>test</em> provides a <em>fail</em> method that will throw an assertion error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;
  context.fail("That should never happen")
  // Following statements won't be executed
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The failure can either be a <em>string</em> as seen previously or an <em>error</em>. The <em>error</em> object depends
on the target language, for Java or Groovy it can be any class extending <em>Throwable- , for
JavaScript it is an _error</em>, for Ruby it is an <em>Exception</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_third_party_assertion_framework">Using third-party assertion framework</h3>
<div class="paragraph">
<p>It is also possible to use any other assertion framework, like the popular <em>hamcrest</em> and <em>assertj</em>.
The recommended way to go is to use <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html#verify-io.vertx.core.Handler-">verify</a></code>
and perform the assertions within the supplied <em>Handler</em>. This way, asynchronous testing termination
will be correctly handled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;
  context.verify({ v -&gt;
    // Using here Assert from junit, could be assertj, hamcrest or any other
    // Even manually throwing an AssertionError.
    org.junit.Assert.assertNotNull("not null!")
    org.junit.Assert.assertEquals(10, callbackCount)
  })
})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asynchronous_testing">Asynchronous testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous examples supposed that test cases were terminated after their respective callbacks, this is the
default behavior of a test case callback. Often it is desirable to terminate the test after the test case
callback, for instance:</p>
</div>
<div class="listingblock">
<div class="title">The Async object asynchronously completes the test case</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;
  def async = context.async()
  eventBus.consumer("the-address", { msg -&gt;
    <b class="conum">(2)</b>
    async.complete()
  })
  <b class="conum">(1)</b>
})</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The callback exits but the test case is not terminated</p>
</li>
<li>
<p>The event callback from the bus terminates the test</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Creating an <code><a href="../../apidocs/io/vertx/ext/unit/Async.html">Async</a></code> object with the <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html#async--">async</a></code> method marks the
executed test case as non terminated. The test case terminates when the <code><a href="../../apidocs/io/vertx/ext/unit/Async.html#complete--">complete</a></code>
method is invoked.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When the <code>complete</code> callback is not invoked, the test case fails after a certain timeout.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Several <code>Async</code> objects can be created during the same test case, all of them must be <em>completed</em> to terminate
the test.</p>
</div>
<div class="listingblock">
<div class="title">Several Async objects provide coordination</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { context -&gt;

  def async1 = context.async()
  def client = vertx.createHttpClient()
  def req = client.get(8080, "localhost", "/")
  req.exceptionHandler({ err -&gt;
    context.fail(err.getMessage())
  })
  req.handler({ resp -&gt;
    context.assertEquals(200, resp.statusCode())
    async1.complete()
  })
  req.end()

  def async2 = context.async()
  vertx.eventBus().consumer("the-address", { msg -&gt;
    async2.complete()
  })
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Async objects can also be used in <em>before</em> or <em>after</em> callbacks, it can be very convenient in a <em>before</em> callback
to implement a setup that depends on one or several asynchronous results:</p>
</div>
<div class="listingblock">
<div class="title">Async starts an http server before test cases</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.before({ context -&gt;
  def async = context.async()
  def server = vertx.createHttpServer()
  server.requestHandler(requestHandler)
  server.listen(8080, { ar -&gt;
    context.assertTrue(ar.succeeded())
    async.complete()
  })
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to wait until the completion of a specific <code><a href="../../apidocs/io/vertx/ext/unit/Async.html">Async</a></code>, similar
to Java&#8217;s count-down latch:</p>
</div>
<div class="listingblock">
<div class="title">Wait for completion</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def async = context.async()
def server = vertx.createHttpServer()
server.requestHandler(requestHandler)
server.listen(8080, { ar -&gt;
  context.assertTrue(ar.succeeded())
  async.complete()
})

// Wait until completion
async.awaitSuccess()

// Do something else</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
this should not be executed from the event loop!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Async can also be created with an initial count value, it completes when the count-down reaches
zero using <code><a href="../../apidocs/io/vertx/ext/unit/Async.html#countDown--">countDown</a></code>:</p>
</div>
<div class="listingblock">
<div class="title">Wait until the complete count-down reaches zero</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def async = context.async(2)
def server = vertx.createHttpServer()
server.requestHandler(requestHandler)
server.listen(8080, { ar -&gt;
  context.assertTrue(ar.succeeded())
  async.countDown()
})

vertx.setTimer(1000, { id -&gt;
  async.complete()
})

// Wait until completion of the timer and the http request
async.awaitSuccess()

// Do something else</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling <code>complete()</code> on an async completes the async as usual, it actually sets the value to <code>0</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asynchronous_assertions">Asynchronous assertions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>`<a href="../../apidocs/io/vertx/ext/unit/TestContext.html">TestContext</a>`provides useful methods that provides powerful constructs for async testing:</p>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html#asyncAssertSuccess--">asyncAssertSuccess</a></code> method returns an {@literal Handler&lt;AsyncResult&lt;T&gt;&gt;}
instance that acts like <code><a href="../../apidocs/io/vertx/ext/unit/Async.html">Async</a></code>, resolving the <code>Async</code> on success and failing the test
on failure with the failure cause.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Async async = context.async();
vertx.deployVerticle("my.verticle", ar -&gt; {
  if (ar.succeeded()) {
    async.complete();
  } else {
    context.fail(ar.cause());
  }
});

// Can be replaced by

vertx.deployVerticle("my.verticle", context.asyncAssertSuccess());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html#asyncAssertSuccess-io.vertx.core.Handler-">asyncAssertSuccess</a></code> method returns an {@literal Handler&lt;AsyncResult&lt;T&gt;&gt;}
instance that acts like <code><a href="../../apidocs/io/vertx/ext/unit/Async.html">Async</a></code>, invoking the delegating {@literal Handler&lt;T&gt;} on success
and failing the test on failure with the failure cause.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">AtomicBoolean started = new AtomicBoolean();
Async async = context.async();
vertx.deployVerticle(new AbstractVerticle() {
  public void start() throws Exception {
    started.set(true);
  }
}, ar -&gt; {
  if (ar.succeeded()) {
    context.assertTrue(started.get());
    async.complete();
  } else {
    context.fail(ar.cause());
  }
});

// Can be replaced by

vertx.deployVerticle("my.verticle", context.asyncAssertSuccess(id -&gt; {
  context.assertTrue(started.get());
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The async is completed when the <code>Handler</code> exits, unless new asyncs were created during the invocation, which
can be handy to <em>chain</em> asynchronous behaviors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Async async = context.async();
vertx.deployVerticle("my.verticle", ar1 -&gt; {
  if (ar1.succeeded()) {
    vertx.deployVerticle("my.otherverticle", ar2 -&gt; {
      if (ar2.succeeded()) {
        async.complete();
      } else {
        context.fail(ar2.cause());
      }
    });
  } else {
    context.fail(ar1.cause());
  }
});

// Can be replaced by

vertx.deployVerticle("my.verticle", context.asyncAssertSuccess(id -&gt;
        vertx.deployVerticle("my_otherverticle", context.asyncAssertSuccess())
));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html#asyncAssertFailure--">asyncAssertFailure</a></code> method returns an {@literal Handler&lt;AsyncResult&lt;T&gt;&gt;}
instance that acts like <code><a href="../../apidocs/io/vertx/ext/unit/Async.html">Async</a></code>, resolving the <code>Async</code> on failure and failing the test
on success.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Async async = context.async();
vertx.deployVerticle("my.verticle", ar -&gt; {
  if (ar.succeeded()) {
    context.fail();
  } else {
    async.complete();
  }
});

// Can be replaced by

vertx.deployVerticle("my.verticle", context.asyncAssertFailure());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html#asyncAssertFailure-io.vertx.core.Handler-">asyncAssertFailure</a></code> method returns an {@literal Handler&lt;AsyncResult&lt;T&gt;&gt;}
instance that acts like <code><a href="../../apidocs/io/vertx/ext/unit/Async.html">Async</a></code>, invoking the delegating {@literal Handler&lt;Throwable&gt;} on
failure and failing the test on success.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Async async = context.async();
vertx.deployVerticle("my.verticle", ar -&gt; {
  if (ar.succeeded()) {
    context.fail();
  } else {
    context.assertTrue(ar.cause() instanceof IllegalArgumentException);
    async.complete();
  }
});

// Can be replaced by

vertx.deployVerticle("my.verticle", context.asyncAssertFailure(cause -&gt; {
  context.assertTrue(cause instanceof IllegalArgumentException);
}));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The async is completed when the <code>Handler</code> exits, unless new asyncs were created during the invocation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repeating_test">Repeating test</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a test fails randomly or not often, for instance a race condition, it is convenient to run the same
test multiple times to increase the failure likelihood of the test.</p>
</div>
<div class="listingblock">
<div class="title">Repeating a test</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">TestSuite.create("my_suite").test("my_test", 1000, { context -&gt;
  // This will be executed 1000 times
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>When declared, <em>beforeEach</em> and <em>afterEach</em> callbacks will be executed as many times as the test is executed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
test repetition are executed sequentially
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sharing_objects">Sharing objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html">TestContext</a></code> has <code>get</code>/<code>put</code>/<code>remove</code> operations for sharing state between callbacks.</p>
</div>
<div class="paragraph">
<p>Any object added during the <em>before</em> callback is available in any other callbacks. Each test case will operate on
a copy of the shared state, so updates will only be visible for a test case.</p>
</div>
<div class="listingblock">
<div class="title">Sharing state between callbacks</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">TestSuite.create("my_suite").before({ context -&gt;

  // host is available for all test cases
  context.put("host", "localhost")

}).beforeEach({ context -&gt;

  // Generate a random port for each test
  def port = helper.randomPort()

  // Get host
  def host = context.get("host")

  // Setup server
  def async = context.async()
  def server = vertx.createHttpServer()
  server.requestHandler({ req -&gt;
    req.response().setStatusCode(200).end()
  })
  server.listen(port, host, { ar -&gt;
    context.assertTrue(ar.succeeded())
    context.put("port", port)
    async.complete()
  })

}).test("my_test", { context -&gt;

  // Get the shared state
  def port = context.get("port")
  def host = context.get("host")

  // Do request
  def client = vertx.createHttpClient()
  def req = client.get(port, host, "/resource")
  def async = context.async()
  req.handler({ resp -&gt;
    context.assertEquals(200, resp.statusCode())
    async.complete()
  })
  req.end()
})</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
sharing any object is only supported in Java, other languages can share only basic or json types.
Other objects should be shared using the features of that language.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running">Running</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a test suite is created, it won&#8217;t be executed until the <code><a href="../../apidocs/io/vertx/ext/unit/TestSuite.html#run--">run</a></code> method
is called.</p>
</div>
<div class="listingblock">
<div class="title">Running a test suite</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.run()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test suite can also be run with a specified <code><a href="../../apidocs/io/vertx/core/Vertx.html">Vertx</a></code> instance:</p>
</div>
<div class="listingblock">
<div class="title">Provides a Vertx instance to run the test suite</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.run(vertx)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When running with a <code>Vertx</code> instance, the test suite is executed using the Vertx event loop, see the <a href="#event_loop">Event loop</a>
section for more details.</p>
</div>
<div class="paragraph">
<p>A test suite can be run with the Vert.x Command Line Interface with the <code>vertx test</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Running a test suite with the Vert.x CLI</div>
<div class="content">
<pre class="highlight"><code>&gt; vertx test the_test_suite.js
Begin test suite the_test_suite
Succeeded in deploying verticle
Begin test my_test_case
Passed my_test_case
End test suite my_suite , run: 1, Failures: 0, Errors: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such test suite just need to be executed via the <code><a href="../../apidocs/io/vertx/ext/unit/TestSuite.html#run--">run</a></code> command, the
<code>vertx test</code> command takes care of configuring reporting, timeout, etc&#8230;&#8203;, pretty much like in this
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def suite = TestSuite.create("the_test_suite")
suite.test("my_test_case", { context -&gt;
  def s = "value"
  context.assertEquals("value", s)
})
suite.run()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>vertx test</code> command extends the <code>vertx run</code> command. The exit behavior of the JVM is changed
the JVM exits when the test suite is executed and a return value is provided indicating the tests
success (0) or failure (1).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
several test suites can executed in the same verticle, Vert.x Unit waits until completion of
all suite executed.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_test_suite_completion">Test suite completion</h3>
<div class="paragraph">
<p>No assumptions can be made about when the test suite will be completed, and if some code needs to be executed
after the test suite, it should either be in the test suite <em>after</em> callback or as callback of the
<code><a href="../../apidocs/io/vertx/ext/unit/Completion.html">Completion</a></code>:</p>
</div>
<div class="listingblock">
<div class="title">Test suite execution callback</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def completion = suite.run(vertx)

// Simple completion callback
completion.handler({ ar -&gt;
  if (ar.succeeded()) {
    println("Test suite passed!")
  } else {
    println("Test suite failed:")
    ar.cause().printStackTrace()
  }
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/Completion.html">Completion</a></code> object provides also a <code><a href="../../apidocs/io/vertx/ext/unit/Completion.html#resolve-io.vertx.core.Future-">resolve</a></code> method that
takes a <code>Future</code> object, this <code>Future</code> will be notified of the test suite execution:</p>
</div>
<div class="listingblock">
<div class="title">Resolving the start Future with the test suite</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def completion = suite.run()

// When the suite completes, the future is resolved
completion.resolve(startFuture)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allow to easily create a <em>test</em> verticle whose deployment is the test suite execution, allowing the
code that deploys it to be easily aware of the success or failure.</p>
</div>
<div class="paragraph">
<p>The completion object can also be used like a latch to block until the test suite completes. This should
be used when the thread running the test suite is not the same than the current thread:</p>
</div>
<div class="listingblock">
<div class="title">Blocking until the test suite completes</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def completion = suite.run()

// Wait until the test suite completes
completion.await()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>await</code> throws an exception when the thread is interrupted or a timeout is fired.</p>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/Completion.html#awaitSuccess--">awaitSuccess</a></code> is a variation that throws an exception when
the test suite fails.</p>
</div>
<div class="listingblock">
<div class="title">Blocking until the test suite succeeds</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def completion = suite.run()

// Wait until the test suite succeeds otherwise throw an exception
completion.awaitSuccess()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_time_out">Time out</h3>
<div class="paragraph">
<p>Each test case of a test suite must execute before a certain timeout is reached. The default timeout is
of <em>2 minutes</em>, it can be changed using <em>test options</em>:</p>
</div>
<div class="listingblock">
<div class="title">Setting the test suite timeout</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def options = [
  timeout:10000
]

// Run with a 10 seconds time out
suite.run(options)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="event_loop">Event loop</h3>
<div class="paragraph">
<p>Vertx Unit execution is a list of tasks to execute, the execution of each task is driven by the completion
of the previous task. These tasks should leverage Vert.x event loop when possible but that depends on the
current execution context (i.e the test suite is executed in a <code>main</code> or embedded in a <code>Verticle</code>) and
wether or not a <code>Vertx</code> instance is configured.</p>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/TestOptions.html#setUseEventLoop-java.lang.Boolean-">setUseEventLoop</a></code> configures the usage of the event
loop:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Event loop usage</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">useEventLoop:null</th>
<th class="tableblock halign-left valign-top">useEventLoop:true</th>
<th class="tableblock halign-left valign-top">useEventLoop:false</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Vertx</code> instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use vertx event loop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use vertx event loop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">force no event loop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">in a <code>Verticle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use current event loop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use current event loop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">force no event loop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">in a <em>main</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use no event loop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raise an error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use no event loop</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The default <code>useEventLoop</code> value is <code>null</code>, that means that it will uses an event loop when possible and fallback
to no event loop when no one is available.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reporting">Reporting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reporting is an important piece of a test suite, Vertx Unit can be configured to run with different kind
of reporters.</p>
</div>
<div class="paragraph">
<p>By default no reporter is configured, when running a test suite, <em>test options</em> can be provided to
configure one or several:</p>
</div>
<div class="listingblock">
<div class="title">Using the console reporter and as a junit xml file</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">// Report to console
def consoleReport = [
  to:"console"
]

// Report junit files to the current directory
def junitReport = [
  to:"file:.",
  format:"junit"
]

suite.run([
  reporters:[
    consoleReport,
    junitReport
  ]
])</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_console_reporting">Console reporting</h3>
<div class="paragraph">
<p>Reports to the JVM <code>System.out</code> and <code>System.err</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">to</dt>
<dd>
<p><em>console</em></p>
</dd>
<dt class="hdlist1">format</dt>
<dd>
<p><em>simple</em> or <em>junit</em></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_file_reporting">File reporting</h3>
<div class="paragraph">
<p>Reports to a file, a <code>Vertx</code> instance must be provided:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">to</dt>
<dd>
<p><em>file</em> <code>:</code> <em>dir name</em></p>
</dd>
<dt class="hdlist1">format</dt>
<dd>
<p><em>simple</em> or <em>junit</em></p>
</dd>
<dt class="hdlist1">example</dt>
<dd>
<p><code>file:.</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The file reporter will create files in the configured directory, the files will be named after the
test suite name executed and the format (i.e <em>simple</em> creates <em>txt</em> files and <em>junit</em> creates <em>xml</em>
files).</p>
</div>
</div>
<div class="sect2">
<h3 id="_log_reporting">Log reporting</h3>
<div class="paragraph">
<p>Reports to a logger, a <code>Vertx</code> instance must be provided:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">to</dt>
<dd>
<p><em>log</em> <code>:</code> <em>logger name</em></p>
</dd>
<dt class="hdlist1">example</dt>
<dd>
<p><code>log:mylogger</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_event_bus_reporting">Event bus reporting</h3>
<div class="paragraph">
<p>Reports events to the event bus, a <code>Vertx</code> instance must be provided:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">to</dt>
<dd>
<p><em>bus</em> <code>:</code> <em>event bus address</em></p>
</dd>
<dt class="hdlist1">example</dt>
<dd>
<p><code>bus:the-address</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It allow to decouple the execution of the test suite from the reporting.</p>
</div>
<div class="paragraph">
<p>The messages sent over the event bus can be collected by the <code><a href="../../apidocs/io/vertx/ext/unit/collect/EventBusCollector.html">EventBusCollector</a></code>
and achieve custom reporting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">def collector = EventBusCollector.create(vertx, [
  reporters:[
    [
      to:"file:report.xml",
      format:"junit"
    ]
  ]
])

collector.register("the-address")</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vertx_integration">Vertx integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, assertions and failures must be done on the <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html">TestContext</a></code> and throwing an
assertion error works only when called by Vert.x Unit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("my_test_case", { ctx -&gt;

  // The failure will be reported by Vert.x Unit
  throw new java.lang.RuntimeException("it failed!")
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a regular Vert.x callback, the failure will be ignored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.test("test-server", { testContext -&gt;
  def server = vertx.createHttpServer().requestHandler({ req -&gt;
    if (req.path() == "/somepath") {
      throw new java.lang.AssertionError("Wrong path!")
    }
    req.response().end()
  })
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since Vert.x 3.3, a global exception handler can be set to report the event loop uncaught exceptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">suite.before({ testContext -&gt;

  // Report uncaught exceptions as Vert.x Unit failures
  vertx.exceptionHandler(testContext.exceptionHandler())
})

suite.test("test-server", { testContext -&gt;
  def server = vertx.createHttpServer().requestHandler({ req -&gt;
    if (req.path() == "/somepath") {
      throw new java.lang.AssertionError("Wrong path!")
    }
    req.response().end()
  })
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The exception handler is set during the <em>before</em> phase, the <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html">TestContext</a></code> is shared
between each <em>before</em>, <em>test</em> and <em>after</em> phase. So the exception handler obtained during the <em>before</em> phase
is correct.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_junit_integration">Junit integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although Vertx Unit is polyglot and not based on JUnit, it is possible to run a Vertx Unit test suite or a test case
from JUnit, allowing you to integrate your tests with JUnit and your build system or IDE.</p>
</div>
<div class="listingblock">
<div class="title">Run a Java class as a JUnit test suite</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RunWith(VertxUnitRunner.class)
public class JUnitTestSuite {
  @Test
  public void testSomething(TestContext context) {
    context.assertFalse(false);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code><a href="../../apidocs/io/vertx/ext/unit/junit/VertxUnitRunner.html">VertxUnitRunner</a></code> uses the junit annotations for introspecting the class
and create a test suite after the class. The methods should declare a <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html">TestContext</a></code>
argument, if they don&#8217;t it is fine too. However the <code>TestContext</code> is the only way to retrieve the associated
Vertx instance of perform asynchronous tests.</p>
</div>
<div class="paragraph">
<p>The JUnit integration is also available for the Groovy language with the <code>io.vertx.groovy.ext.unit.junit.VertxUnitRunner</code>
runner.</p>
</div>
<div class="sect2">
<h3 id="_running_a_test_on_a_vert_x_context">Running a test on a Vert.x context</h3>
<div class="paragraph">
<p>By default the thread invoking the test methods is the JUnit thread. The <code><a href="../../apidocs/io/vertx/ext/unit/junit/RunTestOnContext.html">RunTestOnContext</a></code>
JUnit rule can be used to alter this behavior for running these test methods with a Vert.x event loop thread.</p>
</div>
<div class="paragraph">
<p>Thus there must be some care when state is shared between test methods and Vert.x handlers as they won&#8217;t be
on the same thread, e.g incrementing a counter in a Vert.x handler and asserting the counter in the test method.
One way to solve this is to use proper synchronization, another is to execute test methods on a Vert.x context
that will be propagated to the created handlers.</p>
</div>
<div class="paragraph">
<p>For this purpose the <code><a href="../../apidocs/io/vertx/ext/unit/junit/RunTestOnContext.html">RunTestOnContext</a></code> rule needs a <code><a href="../../apidocs/io/vertx/core/Vertx.html">Vertx</a></code>
instance. Such instance can be provided, otherwise the rule will manage an instance under the hood. Such
instance can be retrieved when the test is running, making this rule a way to manage a <code><a href="../../apidocs/io/vertx/core/Vertx.html">Vertx</a></code>
instance as well.</p>
</div>
<div class="listingblock">
<div class="title">Run a Java class as a JUnit test suite</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RunWith(VertxUnitRunner.class)
public class RunOnContextJUnitTestSuite {

  @Rule
  public RunTestOnContext rule = new RunTestOnContext();

  @Test
  public void testSomething(TestContext context) {
    // Use the underlying vertx instance
    Vertx vertx = rule.vertx();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule can be annotated by {@literal @Rule} or {@literal @ClassRule}, the former manages a Vert.x instance
per test, the later a single Vert.x for the test methods of the class.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
keep in mind that you cannot block the event loop when using this rule. Usage of classes like
<code>CountDownLatch</code> or similar classes must be done with care.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_timeout">Timeout</h3>
<div class="paragraph">
<p>The Vert.x Unit 2 minutes timeout can be overriden with the <code>timeout</code> member of the <code>@Test</code> annotation:</p>
</div>
<div class="listingblock">
<div class="title">Configure the timeout at the test level</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class JunitTestWithTimeout {

  @Test(timeout = 1000l)
  public void testSomething(TestContext context) {
    //...
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a more global configuration, the <code><a href="../../apidocs/io/vertx/ext/unit/junit/Timeout.html">Timeout</a></code> rule can be used:</p>
</div>
<div class="listingblock">
<div class="title">Configure the timeout at the class level</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RunWith(VertxUnitRunner.class)
public class TimeoutTestSuite {

  @Rule
  public Timeout rule = Timeout.seconds(1);

  @Test
  public void testSomething(TestContext context) {
    //...
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
the <code>@Test</code> timeout overrides the the <code><a href="../../apidocs/io/vertx/ext/unit/junit/Timeout.html">Timeout</a></code> rule.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_parameterized_tests">Parameterized tests</h3>
<div class="paragraph">
<p>JUnit provides useful <code>Parameterized</code> tests, Vert.x Unit tests can be ran with this particular runner thanks to
the <code><a href="../../apidocs/io/vertx/ext/unit/junit/VertxUnitRunnerWithParametersFactory.html">VertxUnitRunnerWithParametersFactory</a></code>:</p>
</div>
<div class="listingblock">
<div class="title">Running a Vert.x Unit parameterized test</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@RunWith(Parameterized.class)
@Parameterized.UseParametersRunnerFactory(VertxUnitRunnerWithParametersFactory.class)
public class SimpleParameterizedTest {

  @Parameterized.Parameters
  public static Iterable&lt;Integer&gt; data() {
    return Arrays.asList(0, 1, 2);
  }

  public SimpleParameterizedTest(int value) {
    //...
  }

  @Test
  public void testSomething(TestContext context) {
    // Execute test with the current value
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameterized tests can also be done in Groovy with the <code>io.vertx.groovy.ext.unit.junit.VertxUnitRunnerWithParametersFactory</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_repeating_a_test">Repeating a test</h3>
<div class="paragraph">
<p>When a test fails randomly or not often, for instance a race condition, it is convenient to run the same
test multiple times to increase the likelihood failure of the test.</p>
</div>
<div class="paragraph">
<p>With JUnit a test has to be annotated with <code><a href="../../apidocs/io/vertx/ext/unit/junit/Repeat.html">@Repeat</a></code> to be repeated. The test must
also define the <code><a href="../../apidocs/io/vertx/ext/unit/junit/RepeatRule.html">RepeatRule</a></code> among its rules.</p>
</div>
<div class="listingblock">
<div class="title">Repeating a test with JUnit</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">@RunWith(VertxUnitRunner.class)
public class RepeatingTest {

  @Rule
  public RepeatRule rule = new RepeatRule();

  @Repeat(1000)
  @Test
  public void testSomething(TestContext context) {
    // This will be executed 1000 times
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When declared, <em>before</em> and <em>after</em> life cycle will be executed as many times as the test is executed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
test repetition are executed sequentially
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_with_other_assertion_libraries">Using with other assertion libraries</h3>
<div class="paragraph">
<p>Vert.x Unit usability has been greatly improved in Vert.x 3.3. You can now write tests using
<a href="http://hamcrest.org/">Hamcrest</a>, <a href="http://joel-costigliola.github.io/assertj/">AssertJ</a>,
<a href="https://github.com/rest-assured/rest-assured/">Rest Assured</a>, or any assertion library you want. This is made
possible by the global exception handler described in <a href="#vertx_integration">Vertx integration</a>.</p>
</div>
<div class="paragraph">
<p>You can find Java examples of using Vert.x Unit with Hamcrest and AssertJ in the
<a href="https://github.com/vert-x3/vertx-examples/tree/master/unit-examples">vertx-examples</a> project.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_language_integration">Java language integration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_test_suite_integration">Test suite integration</h3>
<div class="paragraph">
<p>The Java language provides classes and it is possible to create test suites directly from Java classes with the
following mapping rules:</p>
</div>
<div class="paragraph">
<p>The {@code testSuiteObject} argument methods are inspected and the public, non static methods
with <code><a href="../../apidocs/io/vertx/ext/unit/TestContext.html">TestContext</a></code> parameter are retained and mapped to a Vertx Unit test suite
via the method name:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>before</code> : before callback</p>
</li>
<li>
<p><code>after</code> : after callback</p>
</li>
<li>
<p><code>beforeEach</code> : beforeEach callback</p>
</li>
<li>
<p><code>afterEach</code> : afterEach callback</p>
</li>
<li>
<p>when the name starts with <em>test</em> : test case callback named after the method name</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Test suite written using a Java class</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyTestSuite {

  public void testSomething(TestContext context) {
    context.assertFalse(false);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class can be turned into a Vertx test suite easily:</p>
</div>
<div class="listingblock">
<div class="title">Create a test suite from a Java object</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">TestSuite suite = TestSuite.create(new MyTestSuite());</code></pre>
</div>
</div>
</div>
</div>
</div>
        

        
          <div id="footer">
            <div id="footer-text">
              
                上次更新时间 2018-11-06 11:20:34 CST
              
              
            </div>
          </div>
        
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Eclipse Vert.x</h2>
        <ul class="list-unstyled">
          <li><a href="https://vertx.tk/">主页</a></li>
          <li><a href="https://vertx.tk/download/">下载</a></li>
          <li><a href="https://vertx.tk/docs/">文档</a></li>
          <li><a href="https://github.com/vert-x3/wiki/wiki">维基</a></li>
          <li><a href="https://vertx.tk/blog/">博客</a></li>
        </ul>
      </div>
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Community</h2>
        <ul class="list-unstyled">
          <li><a href="https://vertx.tk/community/">Help &amp; Contributors</a></li>
          <li><a href="https://vertx.tk/materials/">Learning materials</a></li>
          <li><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx">User Group</a></li>
          <li><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx-dev">Developer Group</a></li>
          <li><a href="//shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad">QQ群</a></li>
        </ul>
      </div>
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Eclipse</h2>
        <ul class="list-unstyled">
          <li><a href="http://www.eclipse.org/">Eclipse Foundation</a></li>
          <li><a href="https://eclipse.org/legal/privacy.php">Privacy Policy</a></li>
          <li><a href="https://eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
          <li><a href="https://eclipse.org/legal/copyright.php">Copyright Agent</a></li>
          <li><a href="http://www.eclipse.org/legal">Legal Resources</a></li>
        </ul>
      </div>

      <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 copyright">
        <p>Eclipse Vert.x is open source and dual-licensed under the <a href="http://www.eclipse.org/legal/epl-v20.html">Eclipse Public License 2.0</a> and <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License 2.0</a>.</p>
        <p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>
        Design by <a href="https://www.michel-kraemer.com">Michel Kr&auml;mer</a>.</p>
        <div class="row">
          <div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-2">
            <a href="http://eclipse.org">
            <img class="logo eclipse-logo" src="https://vertx.tk/assets/eclipse_logo_grey_small.png" width="204" height="48">
            </a>
          </div>
          <div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-0">
            <a href="http://cloudbees.com">
            <img class="logo cloudbees-logo" src="https://vertx.tk/assets/Button-Built-on-CB-1-grey.png" width="180" height="48">
           </a>
          </div>
          <div class="col-sm-12 col-md-5 col-md-offset-7 jprofiler">
            <a href="http://www.ej-technologies.com/products/jprofiler/overview.html"
            style="text-decoration:none">
            <img class="logo jprofiler-logo" src="https://vertx.tk/assets/jprofiler-logo.png" width="48" height="48"><span class="jprofiler-logo">&nbsp; JPROFILER</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://vertx.tk/javascripts/bootstrap.min.js"></script>
<script src="https://vertx.tk/javascripts/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script src="https://vertx.tk/javascripts/sidebar.js"></script>


<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#64386b",
      "text": "#ffcdfd"
    },
    "button": {
      "background": "transparent",
      "text": "#f8a8ff",
      "border": "#f8a8ff"
    }
  },
  "content": {
    "message": "This website uses anonymous cookies to ensure we provide you the best experience. ",
    "link": "Opt out!",
    "href": "https://tools.google.com/dlpage/gaoptout/"
  }
})});
</script>
</body>
</html>

