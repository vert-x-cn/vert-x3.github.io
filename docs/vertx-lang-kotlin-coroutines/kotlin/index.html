<!DOCTYPE html>
<html lang="en">
<head>
  <title>vertx-lang-kotlin-coroutines - Vert.x</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="Eclipse Vert.x is a tool-kit for building reactive applications on the JVM." name="description">
  <link href="https://vertx.tk/stylesheets/docs.css" media="screen" rel="stylesheet">
  <link href="https://vertx.tk/stylesheets/font-awesome.min.css" media="screen" rel="stylesheet">
  <link href="https://vertx.tk/javascripts/styles/rainbow.min.css" media="screen" rel="stylesheet">
  <!-- IE 6-8 support of HTML 5 elements -->
  <!--[if lt IE 9]>
  <script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script>
  <![endif]-->

  <link rel="apple-touch-icon" sizes="57x57" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://vertx.tk/assets/favicons/vertx-favicon-7/manifest.json">
  <link rel="mask-icon" href="https://vertx.tk/assets/favicons/vertx-favicon-7/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#7d3194">
  <meta name="msapplication-TileImage" content="https://vertx.tk/assets/favicons/vertx-favicon-7/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link href="https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel="stylesheet" type="text/css">
  <link rel="alternate" type="application/rss+xml" title="RSS"
     href="https://vertx.tk/feed.xml">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('create', 'UA-71153120-1', 'auto', 'tracker');
    ga('send', 'pageview');
    ga('tracker.send', 'pageview');
  </script>
  <style>
    .page-link-to-github {
      position: relative;
      z-index: 1;
      display: inline-block;
      border: 1px solid #782B90;
      border-radius: 5px;
      color: #782B90;
      font-size: 12px;
      padding: 4px 10px;
      text-decoration: none;
      background-color: #ffffff;
    }
    .page-link-to-github:hover {
      color: #ffffff;
      border-color: #ffffff;
      background-color: #782B90;
    }

    .page-link-to-github .github-icon {
      position: absolute;
      display: inline-block;
      width: 20px;
      height: 20px;
      /*background-position: -50px 0*/
      background: url('https://vertx.tk/assets/github.png') no-repeat 0 0;
    }

    @media (-webkit-min-device-pixel-ratio: 2),(min-resolution:192dpi) {
      .page-link-to-github .github-icon {
        background-image:url('https://vertx.tk/assets/github@2x.png');
        background-size: 150px auto
      }
    }

    .page-link-to-github:hover .github-icon {
      /*background-position: 0 0*/
      background-position: -100px 0
    }
    .text {
      text-decoration: underline
    }
    .page-link-to-github .text {
      padding-left: 27px
    }
    .text {
      padding-right: 8px
    }
    .page-link-to-github {
      float: right;
      top: 4px
    }

  </style>
</head>
<body>

<a href="http://www.reactivemanifesto.org/" id="reactive-manifesto-banner">
  <img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000"
    src="https://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png">
</a>

<a id="skippy" class="sr-only sr-only-focusable" href="#content"><div class="container"><span class="skiplink-text">Skip to main content</span></div></a>

<header class="navbar navbar-default navbar-static-top" id="top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#vertx-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="https://vertx.tk/" class="navbar-brand"><img alt="Brand" src="https://vertx.tk/assets/logo-sm.png"></a>
    </div>
    <nav class="collapse navbar-collapse" id="vertx-navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="http://start.vertx.io">Starter</a></li>
        <li><a href="https://vertx.io">官网</a></li>
        <li><a href="https://vertx.tk/download/">下载</a></li>
        <li><a href="https://vertx.tk/docs/">文档</a></li>
        <li><a href="https://github.com/vert-x3/wiki/wiki">维基</a></li>
        <li><a href="https://vertx.tk/community/">社区</a></li>
        <li><a href="https://vertx.tk/materials/">资料</a></li>
        <li><a href="https://vertx.tk/blog/">博客</a></li>
      </ul>
    </nav>
  </div>
</header>



  <div class="page-header" id="content">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1>vertx-lang-kotlin-coroutines</h1>
          
        </div>
      </div>
    </div>
  </div>



<div id="content">
  <div class="container docs-content">
    <div class="row">
      <div class="col-sm-12 col-md-push-9 col-md-3 hidden-xs hidden-sm">
        <div id="sidebar" data-spy="affix">
          <ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_running_a_coroutine_from_a_vert_x_context">Running a coroutine from a Vert.x context</a></li>
<li><a href="#_extending_coroutineverticle">Extending CoroutineVerticle</a></li>
<li><a href="#_getting_one_shot_asynchronous_results">Getting one-shot asynchronous results</a></li>
<li><a href="#_getting_one_shot_events">Getting one-shot events</a></li>
<li><a href="#_getting_one_shot_worker_results">Getting one-shot worker results</a></li>
<li><a href="#_streams_of_events">Streams of events</a></li>
<li><a href="#_awaiting_the_completion_of_vert_x_asynchronous_results">Awaiting the completion of Vert.x asynchronous results</a></li>
<li><a href="#_suspending_extension_methods">Suspending extension methods</a></li>
<li><a href="#_channels">Channels</a>
<ul class="sectlevel2">
<li><a href="#_receiving_data">Receiving data</a></li>
<li><a href="#_sending_data">Sending data</a></li>
</ul>
</li>
<li><a href="#_delay_cancellation_and_timeouts">Delay, cancellation and timeouts</a></li>
<li><a href="#_coroutine_builders">Coroutine builders</a></li>
<li><a href="#_coroutine_interoperability">Coroutine interoperability</a></li>
<li><a href="#_rxjava_interoperability">RxJava interoperability</a></li>
</ul>
        </div>
      </div>
      <div class="col-sm-12 col-md-pull-3 col-md-9">
        <div class="toc hidden-md hidden-lg">
          <h2>Table of Contents</h2>
          <ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_running_a_coroutine_from_a_vert_x_context">Running a coroutine from a Vert.x context</a></li>
<li><a href="#_extending_coroutineverticle">Extending CoroutineVerticle</a></li>
<li><a href="#_getting_one_shot_asynchronous_results">Getting one-shot asynchronous results</a></li>
<li><a href="#_getting_one_shot_events">Getting one-shot events</a></li>
<li><a href="#_getting_one_shot_worker_results">Getting one-shot worker results</a></li>
<li><a href="#_streams_of_events">Streams of events</a></li>
<li><a href="#_awaiting_the_completion_of_vert_x_asynchronous_results">Awaiting the completion of Vert.x asynchronous results</a></li>
<li><a href="#_suspending_extension_methods">Suspending extension methods</a></li>
<li><a href="#_channels">Channels</a>
<ul class="sectlevel2">
<li><a href="#_receiving_data">Receiving data</a></li>
<li><a href="#_sending_data">Sending data</a></li>
</ul>
</li>
<li><a href="#_delay_cancellation_and_timeouts">Delay, cancellation and timeouts</a></li>
<li><a href="#_coroutine_builders">Coroutine builders</a></li>
<li><a href="#_coroutine_interoperability">Coroutine interoperability</a></li>
<li><a href="#_rxjava_interoperability">RxJava interoperability</a></li>
</ul>
        </div>

  <a href="https://github.com/okou19900722/vertx-web-site-translation-chinese/tree/master/vertx-translation-stack/vertx-lang-kotlin-coroutines-translation"
     class="page-link-to-github"
     target="_blank"
     title="Edit this page on GitHub">
    <i class="github-icon"></i>
    <span class="text">编辑本页</span>
  </a>

        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <code>vertx-lang-kotlin-coroutines</code> integrates Kotlin <em>coroutines</em> for performing asynchronous operations and processing events.
This results in using a programming model that looks like sequential code, yet it does not block kernel threads.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the key advantages of Vert.x over many legacy application platforms is that it is almost entirely non-blocking
(of kernel threads).
This allows Vert.x-based applications to handle a lot of concurrency (e.g., many connections and messages) using a very
small number of kernel threads, which in turns unlocks great scalability.</p>
</div>
<div class="paragraph">
<p>The non-blocking nature of Vert.x leads to asynchronous APIs. Asynchronous APIs can take various forms including
callbacks, promises, fibers or reactive extensions. Vert.x uses the callback style for the core APIs but it
also supports other models like RxJava 1 and 2.</p>
</div>
<div class="paragraph">
<p>In some cases, programming using asynchronous APIs can be more challenging than using a classic / sequential style
of code, in particular with several operations need to be done in sequence. Also, error propagation is often more
complex when using asynchronous APIs.</p>
</div>
<div class="paragraph">
<p><code>vertx-lang-kotlin-coroutines</code> uses <em>coroutines</em>. Coroutines are very lightweight threads that do not correspond
to underlying kernel threads, so that when a <em>coroutine</em> needs to <em>"block</em>" it gets <em>suspended</em> and frees
its current kernel thread so that another coroutine can process events.</p>
</div>
<div class="paragraph">
<p><code>vertx-lang-kotlin-coroutines</code> uses <a href="https://github.com/Kotlin/kotlinx.coroutines">kotlinx.coroutines</a> to implement the Coroutines.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>vertx-lang-kotlin-coroutines</code> currently only works with Kotlin and will be out of the <a href="https://kotlinlang.org/docs/reference/coroutines.html#experimental-status-of-coroutines">experimental</a> status
in Kotlin 1.3
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_a_coroutine_from_a_vert_x_context">Running a coroutine from a Vert.x context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Having imported <code>io.vertx.kotlin.coroutines.VertxCoroutine</code>, the <code>GlobalScope.launch</code> method allows to run a block of code as a
coroutine in the "Global" application scope (bounded on the lifetime of the application):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=launchCoroutine]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>vertx.dispatcher()</code> returns a coroutine dispatcher that execute coroutines using the Vert.x event loop.</p>
</div>
<div class="paragraph">
<p>The <code>awaitEvent</code> function suspends the execution of the coroutine until the timer fires and resumes the coroutines
 with the value that was given to the handler.</p>
</div>
<div class="paragraph">
<p>More details are given in the next sections on handlers, events and stream of events.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extending_coroutineverticle">Extending CoroutineVerticle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can deploy your code as instances of <code>io.vertx.kotlin.coroutines.CoroutineVerticle</code>, a specialized type of verticle
for Kotlin coroutines. The <code>CoroutineVerticle</code> class implements the <code>kotlinx.coroutines.experimental.CoroutineScope</code> interface,
making all coroutines builder methods bounded by default to the verticle context. You should override the suspending <code>start()</code>
and (optionally) the suspending <code>stop()</code> methods of the verticle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=CoroutineVerticle]</code></pre>
</div>
</div>
<div class="paragraph">
<p>All code examples below assume to be run inside a <code>CoroutineVerticle</code> implementation, but you can replace all <code>&lt;builder&gt; { .. }</code>
calls with <code>GlobalScope.&lt;builder&gt; { .. }</code> to use the application scope instead.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_one_shot_asynchronous_results">Getting one-shot asynchronous results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many asynchronous operations in Vert.x take a <code>Handler&lt;AsyncResult&lt;T&gt;&gt;</code> as the last argument.
An example would be executing an object retrieval using the Vert.x Mongo client, or sending an event bus message then
awaiting for a reply.</p>
</div>
<div class="paragraph">
<p>This is achieved by using the <code>awaitResult</code> method which returns the value or throws an exception.</p>
</div>
<div class="paragraph">
<p>The coroutine is being suspended until the event is being processed, and no kernel thread is being blocked.</p>
</div>
<div class="paragraph">
<p>The method is executed by specifying the asynchronous operation that needs to be executed in the form of a block that
is passed to the handler at run-time.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=awaitResult]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the block produces a failure, the caller can handle it as an exception using the usual exception
<code>try</code>/<code>catch</code> constructs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=awaitResultFailure]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_one_shot_events">Getting one-shot events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Processing a one-shot event (and not the next occurrences, if any) is achieved using the <code>awaitEvent</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=awaitEvent]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_one_shot_worker_results">Getting one-shot worker results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Processing a blocking computation is achieved using the <code>awaitBlocking</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=awaitBlocking]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_streams_of_events">Streams of events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In many places in Vert.x APIs, streams of events are processed through handlers.
Examples include event bus message consumers and HTTP server requests.</p>
</div>
<div class="paragraph">
<p>The <code>ReceiveChannelHandler</code> class allows receiving events through the (suspendable) <code>receive</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=streamExample]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_awaiting_the_completion_of_vert_x_asynchronous_results">Awaiting the completion of Vert.x asynchronous results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>await</code> extension method on instances of Vert.x asynchronous results suspend coroutines until they have completed, in
which case the method returns the corresponding <code>AsyncResult&lt;T&gt;</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=awaitingFuture]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_suspending_extension_methods">Suspending extension methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since <code>3.6.0</code>, Vert.x generates suspending extension methods for all its asynchronous methods.</p>
</div>
<div class="paragraph">
<p>It relieves the user from using the idiomatic <code>awaitResult</code> and makes the code more natural and readable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=generatedSuspendingExtensionMethod]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each asynchronous method has a suspending counterpart, e.g <code>xyz(1, 2, handler)</code> &#8658; <code>xyzAwait(1, 2)</code>.</p>
</div>
<div class="paragraph">
<p>Such extensions are provided by the <code>io.vertx:vertx-lang-kotlin</code> dependency and covers the Vert.x stack:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>vertx-web</p>
</li>
<li>
<p>vertx-jdbc-client</p>
</li>
<li>
<p>vertx-cassandra-client</p>
</li>
<li>
<p>etc&#8230;&#8203;</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_channels">Channels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Channels are similar to Java <code>BlockingQueue</code> except that they do not block and instead suspend the coroutine
instead of blocking:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sending a value to full channel suspends the coroutine</p>
</li>
<li>
<p>receving a value from an empty channels also suspends the coroutine</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vert.x <code>ReadStream</code> and <code>WriteStream</code> can be adapted to channels with the <code>toChannel</code> extension method.</p>
</div>
<div class="paragraph">
<p>These adapters take care of managing the back-pressure and the stream termination</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ReadStream&lt;T&gt;</code> is adapted to a <code>ReceiveChannel&lt;T&gt;</code></p>
</li>
<li>
<p><code>WriteStream&lt;T&gt;</code> is adapted to a <code>SendChannel&lt;T&gt;</code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_receiving_data">Receiving data</h3>
<div class="paragraph">
<p>Channel can be really useful when you need to handle a stream of correlated values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=channel0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It can also be useful for parsing protocols. We will build a non blocking HTTP request parser to show
the power of channels.</p>
</div>
<div class="paragraph">
<p>We will rely on the <a href="http://vertx.io/docs/apidocs/io/vertx/core/parsetools/RecordParser.html"><code>RecordParser</code></a>
to slice the stream of buffer to a stream of buffer delimited by <code>\r\n</code>.</p>
</div>
<div class="paragraph">
<p>Here is the initial version of the parser, that handles only the HTTP request-line</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=channel1]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parsing the request-line is as simple as calling <code>receive</code> on the channel.</p>
</div>
<div class="paragraph">
<p>The next step parses HTTP headers by receiving chunks until we get an empty one</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=channel2]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally we terminate the parser by handling optional request bodies</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=channel3]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_data">Sending data</h3>
<div class="paragraph">
<p>Using a channel to send data is quite straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=sendChannel]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>SendChannel#send</code> and <code>WriteStream#write</code> are non blocking operations, however unlike <code>SendChannel#send</code>
can suspend the execution when the channel is full, the equivalent without a channel would look like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=sendChannel]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_delay_cancellation_and_timeouts">Delay, cancellation and timeouts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vertx dispatcher fully supports coroutine <code>delay</code> function via Vert.x timers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=delay]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Timers support cancellation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=cancellation]</code></pre>
</div>
</div>
<div class="paragraph">
<p>cancellation is <a href="https://github.com/Kotlin/kotlinx.coroutines/blob/master/coroutines-guide.md#cancellation-is-cooperative">cooperative</a></p>
</div>
<div class="paragraph">
<p>You can also schedule timeout with the <code>withTimeout</code> function</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">Unresolved directive in index.adoc - include::Example.kt[tags=withTimeout]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_coroutine_builders">Coroutine builders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.x works will all coroutine builders, as long as an instance of <code>CoroutineScope</code> is available: <code>launch</code>, <code>async</code>,
`produce', &#8230;&#8203; . A couple of important things to remember:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>runBlocking</code> doesn&#8217;t need a <code>CoroutineScope</code> and must not be used from a Vert.x event loop thread.</p>
</li>
<li>
<p>To avoid memory leaks, always use <code>coroutineScope {..}</code> to define a child scope. In this way, if a coroutine fails
inside the scope, all the others, defined inside that scope, will be cancelled too.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_coroutine_interoperability">Coroutine interoperability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.x integration has been designed to be fully interoperable with Kotlin coroutines</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kotlinx.coroutines.experimental.sync.Mutex</code> are executed on the event loop thread when using the vertx dispatcher</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rxjava_interoperability">RxJava interoperability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The module <code>vertx-lang-kotlin-coroutines</code> does not have specific integration with RxJava however Kotlin coroutines
provide integration with RxJava, which works out nicely with <code>vertx-lang-kotlin-coroutines</code>.</p>
</div>
<div class="paragraph">
<p>You can read about it in the <a href="https://github.com/Kotlin/kotlinx.coroutines/blob/master/reactive/coroutines-guide-reactive.md">Guide to reactive streams with coroutines</a></p>
</div>
</div>
</div>
        

        
          <div id="footer">
            <div id="footer-text">
              
                上次更新时间 2018-11-28 23:00:52 CST
              
              
            </div>
          </div>
        
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Eclipse Vert.x</h2>
        <ul class="list-unstyled">
          <li><a href="https://vertx.tk/">主页</a></li>
          <li><a href="https://vertx.tk/download/">下载</a></li>
          <li><a href="https://vertx.tk/docs/">文档</a></li>
          <li><a href="https://github.com/vert-x3/wiki/wiki">维基</a></li>
          <li><a href="https://vertx.tk/blog/">博客</a></li>
        </ul>
      </div>
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Community</h2>
        <ul class="list-unstyled">
          <li><a href="https://vertx.tk/community/">帮助 &amp; 贡献者</a></li>
          <li><a href="https://vertx.tk/materials/">学习资料</a></li>
          <li><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx">User Group</a></li>
          <li><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx-dev">Developer Group</a></li>
          <li><a href="//shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad">QQ群</a></li>
        </ul>
      </div>
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Eclipse</h2>
        <ul class="list-unstyled">
          <li><a href="http://www.eclipse.org/">Eclipse Foundation</a></li>
          <li><a href="https://eclipse.org/legal/privacy.php">Privacy Policy</a></li>
          <li><a href="https://eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
          <li><a href="https://eclipse.org/legal/copyright.php">Copyright Agent</a></li>
          <li><a href="http://www.eclipse.org/legal">Legal Resources</a></li>
        </ul>
      </div>

      <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 copyright">
        <p>Eclipse Vert.x is open source and dual-licensed under the <a href="http://www.eclipse.org/legal/epl-v20.html">Eclipse Public License 2.0</a> and <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License 2.0</a>.</p>
        <p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>
        Design by <a href="https://www.michel-kraemer.com">Michel Kr&auml;mer</a>.</p>
        <div class="row">
          <div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-2">
            <a href="http://eclipse.org">
            <img class="logo eclipse-logo" src="https://vertx.tk/assets/eclipse_logo_grey_small.png" width="204" height="48">
            </a>
          </div>
          <div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-0">
            <a href="http://cloudbees.com">
            <img class="logo cloudbees-logo" src="https://vertx.tk/assets/Button-Built-on-CB-1-grey.png" width="180" height="48">
           </a>
          </div>
          <div class="col-sm-12 col-md-5 col-md-offset-7 jprofiler">
            <a href="http://www.ej-technologies.com/products/jprofiler/overview.html"
            style="text-decoration:none">
            <img class="logo jprofiler-logo" src="https://vertx.tk/assets/jprofiler-logo.png" width="48" height="48"><span class="jprofiler-logo">&nbsp; JPROFILER</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://vertx.tk/javascripts/bootstrap.min.js"></script>
<script src="https://vertx.tk/javascripts/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script src="https://vertx.tk/javascripts/sidebar.js"></script>


<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#64386b",
      "text": "#ffcdfd"
    },
    "button": {
      "background": "transparent",
      "text": "#f8a8ff",
      "border": "#f8a8ff"
    }
  },
  "content": {
    "message": "This website uses anonymous cookies to ensure we provide you the best experience. ",
    "link": "Opt out!",
    "href": "https://tools.google.com/dlpage/gaoptout/"
  }
})});
</script>
</body>
</html>

